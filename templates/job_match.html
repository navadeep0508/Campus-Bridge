<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Match - Campus Bridge</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="admin-panel">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>Campus Bridge</h2>
            </div>
            <ul class="sidebar-menu">
                <li><a href="/dashboard">Dashboard</a></li>
                <li><a href="/students/admin">Students</a></li>
                <li><a href="/faculty/admin">Faculty</a></li>
                <li><a href="/attendance/admin">Attendance</a></li>
                <li><a href="/code_review">Code Review</a></li>
                <li><a href="/job_match" class="active">Job Match</a></li>
                <li><a href="/logout">Logout</a></li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="content-header">
                <h1>AI-Powered Job Match</h1>
            </div>

            {% if error %}
            <div class="error-message">
                {{ error }}
            </div>
            {% else %}
            <div class="job-match-container">
                <!-- User Profile Section -->
                <div class="profile-section">
                    <h2>Your Profile</h2>
                    <div class="profile-details">
                        <p><strong>Name:</strong> {{ user.name }}</p>
                        <p><strong>Branch:</strong> {{ user.branch }}</p>
                        <p><strong>Skills:</strong> {{ skills|join(', ') }}</p>
                        <div class="education-details">
                            <h3>Education</h3>
                            {% for edu in education %}
                            <div class="education-item">
                                <p><strong>Degree:</strong> {{ edu.degree }}</p>
                                <p><strong>Institution:</strong> {{ edu.institution }}</p>
                                <p><strong>Year:</strong> {{ edu.year }}</p>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>

                <!-- Preferences Section -->
                <div class="preferences-section">
                    <h3>Job Preferences</h3>
                    <form id="preferencesForm">
                        <div class="form-group">
                            <label for="location">Preferred Location</label>
                            <input type="text" id="location" name="location" placeholder="Enter preferred location">
                        </div>
                        <div class="form-group">
                            <label for="salary">Expected Salary Range</label>
                            <input type="text" id="salary" name="salary" placeholder="e.g., 5-10 LPA">
                        </div>
                        <div class="form-group">
                            <label for="jobType">Job Type</label>
                            <select id="jobType" name="jobType">
                                <option value="">Select job type</option>
                                <option value="full-time">Full Time</option>
                                <option value="part-time">Part Time</option>
                                <option value="internship">Internship</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="industry">Preferred Industry</label>
                            <input type="text" id="industry" name="industry" placeholder="e.g., IT, Finance, Healthcare">
                        </div>
                        <div class="form-group">
                            <label for="skillSearch">Search by Skills</label>
                            <input type="text" id="skillSearch" name="skillSearch" placeholder="Enter skills (comma separated)">
                            <small class="form-text text-muted">Enter multiple skills separated by commas</small>
                        </div>
                        <button type="submit" class="btn btn-primary">Get Recommendations</button>
                    </form>
                </div>

                <!-- Results Section -->
                <div class="results-section" style="display: none;">
                    <div class="loading-indicator">
                        <div class="spinner"></div>
                        <p>Analyzing your profile...</p>
                    </div>

                    <div id="recommendations" style="display: none;">
                        <!-- Job Roles -->
                        <div class="job-roles-section">
                            <h2>Recommended Job Roles</h2>
                            <div id="jobRolesList"></div>
                        </div>

                        <!-- Skill Gaps -->
                        <div class="skill-gaps-section">
                            <h2>Skill Gaps to Address</h2>
                            <ul id="skillGapsList"></ul>
                        </div>

                        <!-- Learning Resources -->
                        <div class="learning-resources-section">
                            <h2>Learning Resources</h2>
                            <ul id="learningResourcesList"></ul>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const preferencesForm = document.getElementById('preferencesForm');
            const resultsSection = document.querySelector('.results-section');
            const loadingIndicator = resultsSection.querySelector('.loading-indicator');
            const recommendationsDiv = document.getElementById('recommendations');

            preferencesForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const formData = {
                    location: document.getElementById('location').value,
                    salary: document.getElementById('salary').value,
                    jobType: document.getElementById('jobType').value,
                    industry: document.getElementById('industry').value,
                    skillSearch: document.getElementById('skillSearch').value.split(',').map(skill => skill.trim())
                };
                
                try {
                    showLoading();
                    const response = await fetch('/get_job_recommendations', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(formData)
                    });
                    
                    const data = await response.json();
                    
                    if (response.ok) {
                        displayResults(data.recommendations);
                    } else {
                        showError(data.error || 'Failed to get recommendations');
                    }
                } catch (error) {
                    showError('An error occurred while fetching recommendations');
                } finally {
                    hideLoading();
                }
            });

            function displayResults(recommendations) {
                // Display job roles
                const jobRolesList = document.getElementById('jobRolesList');
                jobRolesList.innerHTML = '';

                recommendations.forEach(rec => {
                    if (rec.job_roles) {
                        rec.job_roles.forEach(role => {
                            const roleCard = document.createElement('div');
                            roleCard.className = 'job-role-card';
                            roleCard.innerHTML = `
                                <h3>${role.title}</h3>
                                <div class="role-details">
                                    <p><strong>Required Skills:</strong> ${role.skills.join(', ')}</p>
                                    <p><strong>Salary Range:</strong> ${role.salary}</p>
                                    <p><strong>Growth Opportunities:</strong> ${role.growth}</p>
                                    <p><strong>Companies:</strong> ${role.companies.join(', ')}</p>
                                </div>
                            `;
                            jobRolesList.appendChild(roleCard);
                        });
                    }

                    // Display skill gaps
                    const skillGapsList = document.getElementById('skillGapsList');
                    skillGapsList.innerHTML = '';
                    if (rec.skill_gaps) {
                        rec.skill_gaps.forEach(gap => {
                            const li = document.createElement('li');
                            li.textContent = gap;
                            skillGapsList.appendChild(li);
                        });
                    }

                    // Display learning resources
                    const learningResourcesList = document.getElementById('learningResourcesList');
                    learningResourcesList.innerHTML = '';
                    if (rec.learning_resources) {
                        rec.learning_resources.forEach(resource => {
                            const li = document.createElement('li');
                            li.textContent = resource;
                            learningResourcesList.appendChild(li);
                        });
                    }
                });
            }

            function showLoading() {
                resultsSection.style.display = 'block';
                loadingIndicator.style.display = 'flex';
                recommendationsDiv.style.display = 'none';
            }

            function hideLoading() {
                loadingIndicator.style.display = 'none';
                recommendationsDiv.style.display = 'block';
            }

            function showError(message) {
                showToast(message, 'error');
            }

            function showToast(message, type = 'info') {
                const toast = document.createElement('div');
                toast.className = `toast toast-${type}`;
                toast.textContent = message;
                document.body.appendChild(toast);

                setTimeout(() => {
                    toast.remove();
                }, 3000);
            }
        });
    </script>
</body>
</html> 